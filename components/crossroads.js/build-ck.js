function purgeDeploy(){[DIST_PATH,DIST_MIN_PATH].forEach(function(e){_fs.existsSync(e)&&_fs.unlinkSync(e)});console.log(" purged deploy.")}function build(){var e=readFile(SRC_DIR+"/wrapper.js"),t=tmpl(e,{LICENSE:readFile(SRC_DIR+"/license.txt"),INTRO_JS:readFile(SRC_DIR+"/intro.js"),CROSSROADS_JS:readFile(SRC_DIR+"/crossroads.js"),ROUTE_JS:readFile(SRC_DIR+"/route.js"),LEXER_JS:readFile(SRC_DIR+"/pattern_lexer.js")},/\/\/::(\w+)::\/\//g);_fs.writeFileSync(DIST_PATH,tmpl(t,_replacements),FILE_ENCODING);console.log(" "+DIST_PATH+" built.")}function readFile(e){return _fs.readFileSync(e,FILE_ENCODING)}function tmpl(e,t,n){function r(e,n){return n in t?t[n]:""}return e.replace(n||/::(\w+)::/g,r)}function uglify(e){var t=require("uglify-js"),n=t.parser,r=t.uglify,i=n.parse(_fs.readFileSync(e,FILE_ENCODING));i=r.ast_mangle(i);i=r.ast_squeeze(i);return r.gen_code(i)}function minify(){var e=tmpl(readFile(SRC_DIR+"/license.txt"),_replacements);_fs.writeFileSync(DIST_MIN_PATH,e+";"+uglify(DIST_PATH)+";",FILE_ENCODING);console.log(" "+DIST_MIN_PATH+" built.")}function pad(e){e=String(e);return e.length<2?"0"+e:e}var FILE_ENCODING="utf-8",SRC_DIR="dev/src",DIST_DIR="dist",DIST_NAME="crossroads.js",DIST_MIN_NAME="crossroads.min.js",DIST_PATH=DIST_DIR+"/"+DIST_NAME,DIST_MIN_PATH=DIST_DIR+"/"+DIST_MIN_NAME,_fs=require("fs"),_path=require("path"),_pkg=JSON.parse(readFile("package.json")),_now=new Date,_replacements={NAME:_pkg.name,AUTHOR:_pkg.author.name,VERSION_NUMBER:_pkg.version,HOMEPAGE:_pkg.homepage,LICENSE:_pkg.licenses[0].type,BUILD_DATE:_now.getUTCFullYear()+"/"+pad(_now.getUTCMonth()+1)+"/"+pad(_now.getUTCDate())+" "+pad(_now.getUTCHours())+":"+pad(_now.getUTCMinutes())};purgeDeploy();build();minify();