// Route --------------
//=====================
/**
     * @constructor
     */function Route(e,t,n,r){var i=isRegExp(e),s=r.patternLexer;this._router=r;this._pattern=e;this._paramsIds=i?null:s.getParamIds(e);this._optionalParamsIds=i?null:s.getOptionalParamsIds(e);this._matchRegexp=i?e:s.compilePattern(e,r.ignoreCase);this.matched=new signals.Signal;this.switched=new signals.Signal;t&&this.matched.add(t);this._priority=n||0}Route.prototype={greedy:!1,rules:void 0,match:function(e){e=e||"";return this._matchRegexp.test(e)&&this._validateParams(e)},_validateParams:function(e){var t=this.rules,n=this._getParamsObject(e),r;for(r in t)if(r!=="normalize_"&&t.hasOwnProperty(r)&&!this._isValidParam(e,r,n))return!1;return!0},_isValidParam:function(e,t,n){var r=this.rules[t],i=n[t],s=!1,o=t.indexOf("?")===0;if(i==null&&this._optionalParamsIds&&arrayIndexOf(this._optionalParamsIds,t)!==-1)s=!0;else if(isRegExp(r)){o&&(i=n[t+"_"]);s=r.test(i)}else if(isArray(r)){o&&(i=n[t+"_"]);s=this._isValidArrayRule(r,i)}else isFunction(r)&&(s=r(i,e,n));return s},_isValidArrayRule:function(e,t){if(!this._router.ignoreCase)return arrayIndexOf(e,t)!==-1;typeof t=="string"&&(t=t.toLowerCase());var n=e.length,r,i;while(n--){r=e[n];i=typeof r=="string"?r.toLowerCase():r;if(i===t)return!0}return!1},_getParamsObject:function(e){var t=this._router.shouldTypecast,n=this._router.patternLexer.getParamValues(e,this._matchRegexp,t),r={},i=n.length,s,o;while(i--){o=n[i];if(this._paramsIds){s=this._paramsIds[i];if(s.indexOf("?")===0&&o){r[s+"_"]=o;o=decodeQueryString(o,t);n[i]=o}if(_hasOptionalGroupBug&&o===""&&arrayIndexOf(this._optionalParamsIds,s)!==-1){o=void 0;n[i]=o}r[s]=o}r[i]=o}r.request_=t?typecastValue(e):e;r.vals_=n;return r},_getParamsArray:function(e){var t=this.rules?this.rules.normalize_:null,n;t=t||this._router.normalizeFn;t&&isFunction(t)?n=t(e,this._getParamsObject(e)):n=this._getParamsObject(e).vals_;return n},interpolate:function(e){var t=this._router.patternLexer.interpolate(this._pattern,e);if(!this._validateParams(t))throw new Error("Generated string doesn't validate against `Route.rules`.");return t},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose();this.switched.dispose();this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}};