/*jshint white:false*//*global signals:false, window:false*//**
 * Hasher
 * @namespace History Manager for rich-media applications.
 * @name hasher
 */var hasher=function(e){function y(e){return String(e||"").replace(/[\\.+*?\^$\[\](){}\/'#]/g,"\\$&")}function b(e){if(!e)return"";var t=new RegExp("^"+y(s.prependHash)+"|"+y(s.appendHash)+"$","g");return e.replace(t,"")}function w(){var e=c.exec(s.getURL());return e&&e[1]?decodeURIComponent(e[1]):""}function E(){return f?f.contentWindow.frameHash:null}function S(){f=n.createElement("iframe");f.src="about:blank";f.style.display="none";n.body.appendChild(f)}function x(){if(f&&o!==E()){var e=f.contentWindow.document;e.open();e.write("<html><head><title>"+n.title+'</title><script type="text/javascript">var frameHash="'+o+'";</script></head><body>&nbsp;</body></html>');e.close()}}function T(e,t){if(o!==e){var n=o;o=e;m&&(t?f.contentWindow.frameHash=e:x());s.changed.dispatch(b(e),b(n))}}function N(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function C(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)}function k(e){e=Array.prototype.slice.call(arguments);var t=e.join(s.separator);t=t?s.prependHash+t.replace(p,"")+s.appendHash:t;return t}function L(e){e=encodeURI(e);d&&g&&(e=e.replace(/\?/,"%3F"));return e}var t=25,n=e.document,r=e.history,i=signals.Signal,s,o,u,a,f,l,c=/#(.*)$/,h=/(\?.*)|(\#.*)/,p=/^\#/,d=!1,v="onhashchange"in e&&n.documentMode!==7,m=d&&!v,g=location.protocol==="file:";m?l=function(){var e=w(),t=E();t!==o&&t!==e?s.setHash(b(t)):e!==o&&T(e)}:l=function(){var e=w();e!==o&&T(e)};s={VERSION:"::VERSION_NUMBER::",appendHash:"",prependHash:"/",separator:"/",changed:new i,stopped:new i,initialized:new i,init:function(){if(a)return;o=w();if(v)N(e,"hashchange",l);else{if(m){f||S();x()}u=setInterval(l,t)}a=!0;s.initialized.dispatch(b(o))},stop:function(){if(!a)return;if(v)C(e,"hashchange",l);else{clearInterval(u);u=null}a=!1;s.stopped.dispatch(b(o))},isActive:function(){return a},getURL:function(){return e.location.href},getBaseURL:function(){return s.getURL().replace(h,"")},setHash:function(t){t=k.apply(null,arguments);if(t!==o){T(t);t===o&&(e.location.hash="#"+L(t))}},replaceHash:function(t){t=k.apply(null,arguments);if(t!==o){T(t,!0);t===o&&e.location.replace("#"+L(t))}},getHash:function(){return b(o)},getHashAsArray:function(){return s.getHash().split(s.separator)},dispose:function(){s.stop();s.initialized.dispose();s.stopped.dispose();s.changed.dispose();f=s=e.hasher=null},toString:function(){return'[hasher version="'+s.VERSION+'" hash="'+s.getHash()+'"]'}};s.initialized.memorize=!0;return s}(window);