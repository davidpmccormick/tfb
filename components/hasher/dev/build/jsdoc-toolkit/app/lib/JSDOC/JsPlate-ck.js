/**
	@constructor
*/JSDOC.JsPlate=function(e){e&&(this.template=IO.readFile(e));this.templateFile=e;this.code="";this.parse()};JSDOC.JsPlate.prototype.parse=function(){this.template=this.template.replace(/\{#[\s\S]+?#\}/gi,"");this.code="var output="+this.template;this.code=this.code.replace(/<for +each="(.+?)" +in="(.+?)" *>/gi,function(e,t,n){return";\rvar $"+t+"_keys = keys("+n+");\rfor(var $"+t+"_i = 0; $"+t+"_i < $"+t+"_keys.length; $"+t+"_i++) {\rvar $"+t+"_last = ($"+t+"_i == $"+t+"_keys.length-1);\rvar $"+t+"_key = $"+t+"_keys[$"+t+"_i];\rvar "+t+" = "+n+"[$"+t+"_key];\routput+="});this.code=this.code.replace(/<if test="(.+?)">/g,";\rif ($1) { output+=");this.code=this.code.replace(/<elseif test="(.+?)"\s*\/>/g,";}\relse if ($1) { output+=");this.code=this.code.replace(/<else\s*\/>/g,";}\relse { output+=");this.code=this.code.replace(/<\/(if|for)>/g,";\r};\routput+=");this.code=this.code.replace(/\{\+\s*([\s\S]+?)\s*\+\}/gi,function(e,t){t=t.replace(/"/g,"");t=t.replace(/(\r?\n)/g," ");return"+ ("+t+") +"});this.code=this.code.replace(/\{!\s*([\s\S]+?)\s*!\}/gi,function(e,t){t=t.replace(/"/g,"");t=t.replace(/(\n)/g," ");return"; "+t+";\routput+="});this.code=this.code+";";this.code=this.code.replace(/(\r?\n)/g,"\\n");this.code=this.code.replace(/"/g,'\\"');this.code=this.code.replace(/\u001e/g,'"')};JSDOC.JsPlate.prototype.toCode=function(){return this.code};JSDOC.JsPlate.keys=function(e){var t=[];if(e.constructor.toString().indexOf("Array")>-1)for(var n=0;n<e.length;n++)t.push(n);else for(var n in e)t.push(n);return t};JSDOC.JsPlate.values=function(e){var t=[];if(e.constructor.toString().indexOf("Array")>-1)for(var n=0;n<e.length;n++)t.push(e[n]);else for(var n in e)t.push(e[n]);return t};JSDOC.JsPlate.prototype.process=function(data,compact){var keys=JSDOC.JsPlate.keys,values=JSDOC.JsPlate.values;try{eval(this.code)}catch(e){print(">> There was an error evaluating the compiled code from template: "+this.templateFile);print("   The error was on line "+e.lineNumber+" "+e.name+": "+e.message);var lines=this.code.split("\r");e.lineNumber-2>=0&&print("line "+(e.lineNumber-1)+": "+lines[e.lineNumber-2]);print("line "+e.lineNumber+": "+lines[e.lineNumber-1]);print("")}compact&&(output=output.replace(/\s+?(\r?)\n/g,"$1\n"));return output};