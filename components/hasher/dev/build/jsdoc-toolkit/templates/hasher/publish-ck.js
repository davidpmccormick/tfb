/** Called automatically by JsDoc Toolkit. */function publish(e){function o(e){return e.memberOf==""}function u(e){return e.is("FILE")}function a(e){return e.is("CONSTRUCTOR")||e.isNamespace}publish.conf={ext:".html",outDir:JSDOC.opt.d||SYS.pwd+"../out/jsdoc/",templatesDir:JSDOC.opt.t||SYS.pwd+"../templates/jsdoc/",symbolsDir:"symbols/",srcDir:"symbols/src/"};load(publish.conf.templatesDir+"js/mootools-1.2.4-core-server.js");load(publish.conf.templatesDir+"js/htmlparser.js");load(publish.conf.templatesDir+"js/jsdom.js");load(publish.conf.templatesDir+"js/showdown.js");markdownConverter=new Showdown.converter;JSDOC.opt.s&&defined(Link)&&Link.prototype._makeSrcLink&&(Link.prototype._makeSrcLink=function(e){return"&lt;"+e+"&gt;"});IO.mkPath((publish.conf.outDir+"symbols/src").split("/"));Link.symbolSet=e;try{var t=new JSDOC.JsPlate(publish.conf.templatesDir+"class.tmpl"),n=new JSDOC.JsPlate(publish.conf.templatesDir+"allclasses.tmpl"),r=new JSDOC.JsPlate(publish.conf.templatesDir+"docsindex.tmpl"),i=new JSDOC.JsPlate(publish.conf.templatesDir+"userdoc.tmpl")}catch(s){print("Couldn't create the required templates: "+s);quit()}var f=e.toArray(),l=JSDOC.opt.srcFiles;for(var c=0,h=l.length;c<h;c++){var p=l[c],d=publish.conf.outDir+"symbols/src/";makeSrcFile(p,d)}var v=f.filter(a).sort(makeSortby("alias"));if(JSDOC.opt.u){var m={};Link.filemap={};for(var c=0,h=v.length;c<h;c++){var g=v[c].alias.toLowerCase();m[g]?m[g]++:m[g]=1;Link.filemap[v[c].alias]=m[g]>1?g+"_"+m[g]:g}}Link.base="../";var y=JSDOC.opt.docs,b=y!==undefined&&y!==null&&y.content instanceof Array&&y.content.length>0,w=b?y.content:null;if(b)for(var c=0;c<w.length;c++)w[c].outFile="userdocs/"+c+".html";publish.docsIndex=b?r.process(w):"";publish.classesIndex=n.process(v);var E=copyResources(publish.conf.outDir+"userdocs/",y===null||y===undefined||!y.resources?null:y.resources),S={};if(b){IO.mkPath((publish.conf.outDir+"userdocs").split("/"));for(var c=0;c<w.length;c++){var x,T="",N=w[c];if(N.preprocess||y.preprocess)x=processWithCommand(y.preprocess||N.preprocess,N.src);else{x=IO.readFile(N.src);ext=FilePath.fileExtension(N.src);if(ext==="markdown"||ext==="md")x=markdownConverter.makeHtml(x);var C=(new Packages.java.io.File(N.src)).getAbsolutePath();E["="+C]=N.outFile}var k=parseDom(x);k instanceof Array&&(k=k.filter(function(e){return e instanceof DomText?e.innerText==1:!0}));if(!(k instanceof Array)&&k.tagName.toLowerCase()==="html"){x=k.getElement("body").innerHTML;T=k.getElement("head")||null;if(T){T.getElements("script").forEach(function(e){if(e.getAttribute("src")&&!isURL(e.getAttribute("src"))){var t=addResource(publish.conf,N,E,S,e.getAttribute("src"));e.setAttribute("src",t)}});T.getElements("link").forEach(function(e){if(!isURL(e.getAttribute("href"))){var t=addResource(publish.conf,N,E,S,e.getAttribute("href"));e.setAttribute("href",t)}})}T=T.innerHTML||""}var L=i.process({content:x,header:T,title:N.title});IO.saveFile(publish.conf.outDir+"userdocs/",c+".html",L)}}for(var c=0,h=v.length;c<h;c++){var A=v[c];A.events=A.getEvents();A.methods=A.getMethods();var O="";O=t.process(A);IO.saveFile(publish.conf.outDir+"symbols/",(JSDOC.opt.u?Link.filemap[A.alias]:A.alias)+publish.conf.ext,O)}Link.base="";publish.docsIndex=b?r.process(w):"";publish.classesIndex=n.process(v);try{var M=new JSDOC.JsPlate(publish.conf.templatesDir+"index.tmpl")}catch(s){print(s.message);quit()}var _=M.process(v);IO.saveFile(publish.conf.outDir,"index"+publish.conf.ext,_);try{var D=new JSDOC.JsPlate(publish.conf.templatesDir+"symbolindex.tmpl")}catch(s){print(s.message);quit()}var P=D.process(buildSymbolList(v));IO.saveFile(publish.conf.outDir,"symbolindex"+publish.conf.ext,P);P=D=null;M=_=v=null;try{var H=new JSDOC.JsPlate(publish.conf.templatesDir+"allfiles.tmpl")}catch(s){print(s.message);quit()}var B=f.filter(u),j=[];for(var c=0;c<l.length;c++)j.push(new JSDOC.Symbol(l[c],[],"FILE",new JSDOC.DocComment("/** */")));for(var c=0;c<B.length;c++){var F=l.indexOf(B[c].alias);j[F]=B[c]}j=j.sort(makeSortby("name"));var I=H.process(j);IO.saveFile(publish.conf.outDir,"files"+publish.conf.ext,I);H=I=l=null;var q=publish.conf.outDir+"static";IO.mkPath(q.split("/"));IO.ls(publish.conf.templatesDir+"static").forEach(function(e){IO.copyFile(e,q)})}function summarize(e){if(typeof e!="undefined")return e.match(/([\w\W]+?\.)[^a-z0-9_$]/i)?RegExp.$1:e}function makeSortby(e){return function(t,n){if(t[e]!=undefined&&n[e]!=undefined){t=t[e].toLowerCase();n=n[e].toLowerCase();return t<n?-1:t>n?1:0}}}function include(e){var e=publish.conf.templatesDir+e;return IO.readFile(e)}function makeSrcFile(e,t,n){if(JSDOC.opt.s)return;if(!n){n=e.replace(/\.\.?[\\\/]/g,"").replace(/[\\\/]/g,"_");n=n.replace(/\:/g,"_")}var r={path:e,name:n,charset:IO.encoding,hilited:""};defined(JSDOC.PluginManager)&&JSDOC.PluginManager.run("onPublishSrc",r);r.hilited&&IO.saveFile(t,n+publish.conf.ext,r.hilited)}function makeSignature(e){if(!e)return"()";var t="("+e.filter(function(e){return e.name.indexOf(".")==-1}).map(function(e){return e.name}).join(", ")+")";return t}function resolveLinks(e,t){e=e.replace(/\{@link ([^} ]+) ?\}/gi,function(e,t){return(new Link).toSymbol(t)});return e}function processWithCommand(e,t){var n,r,i=IO.readFile(t);if(!i){LOG.warn("could not read file: "+t);quit();return null}n=Packages.java.lang.Runtime.getRuntime().exec(e);if(!n){LOG.warn("unable to execute command: "+e);quit();return null}var s=new Packages.java.io.BufferedReader(new Packages.java.io.InputStreamReader(n.getInputStream())),o=new Packages.java.io.PrintWriter(new Packages.java.io.BufferedWriter(new Packages.java.io.OutputStreamWriter(n.getOutputStream())));o.print(i);o.close();i="";while(r=s.readLine()){i+=r;i+="\n"}s.close();n.waitFor();if(n.exitValue()!=0){quit();return null}return i}function buildSymbolList(e){function s(e){var t="="+e.name;r[t]?r[t].symbols.push(e):r[t]={name:e.name,symbols:[e]}}function o(e,t){t&&t.filter(function(t){return t.memberOf==e.alias&&!t.isNamespace||!t.isIgnored}).forEach(s)}var t,n,r={},i=[];for(n=0;n<e.length;n++){t=e[n];if(t.name!=="_global_")switch(t.isa){case"OBJECT":case"CONSTRUCTOR":s(t)}o(t,t.properties);o(t,t.methods);o(t,t.events)}for(n in r)i.push(r[n]);i.sort(makeSortby("name"));return i}function copyDirectory(e,t){var n=new Packages.java.io.File(t),r={};n.listFiles().forEach(function(t){if(t.isFile()){IO.copyFile(t,e,t.getName());r["="+t.getAbsolutePath()]=e+t.getName()}else if(t.isDirectory()){IO.mkPath(e+t.getName());var n=copyDirectory(e+t.getName()+"/",t);for(var i in n)r[i]=n[i]}});return r}function copyResources(e,t){var n={};t&&t instanceof Array&&t.forEach(function(t){var r,i=new Packages.java.io.File(t);if(i.isFile()){IO.copyFile(i.getAbsolutePath(),e,i.getName());n["="+i.getAbsolutePath()]=(new Packages.java.io.File(e+i.getName())).getAbsolutePath()}else if(i.isDirectory()){IO.mkPath(e+i.getName());var s=copyDirectory(e+i.getName()+"/",i.getAbsolutePath());for(var o in s)n[o]=s[o]}});return n}function isURL(e){return/^http:\/\//.test(e)}function findRelativePath(e,t){var n=(new Packages.java.io.File(t)).getAbsoluteFile(),r=(new Packages.java.io.File(e)).getAbsoluteFile();r.isDirectory()||(r=r.getParentFile());var i=String(r.getAbsolutePath()).split(/[\\\/]/),s=String(n.getAbsolutePath()).split(/[\\\/]/);while(i.length&&s.length&&i[0]==s[0]){i.shift();s.shift()}var o=i.map(function(){return".."}).join("/");i.length>0&&(o+="/");o+=s.join("/");return o}function addResource(e,t,n,r,i){var s=new Packages.java.io.File(t.src),o=s.isDirectory()?s.getAbsolutePath():s.getAbsoluteFile().getParent(),u=String((new Packages.java.io.File(o,i)).getCanonicalPath()),a=n["="+u];if(a)return findRelativePath(e.outDir+t.outFile,a);var f=r["="+u];if(f)return findRelativePath(e.outDir+t.outFile,f);var l=FilePath.fileName(u);IO.copyFile(u,e.outDir+"userdocs/",l);var f=e.outDir+"userdocs/"+l;r["="+u]=f;return findRelativePath(e.outDir+t.outFile,f)};