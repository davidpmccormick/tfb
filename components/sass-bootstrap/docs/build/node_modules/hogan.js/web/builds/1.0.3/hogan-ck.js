/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */var HoganTemplate=function(){function e(e){this.text=e}function u(e){e=String(e===null?"":e);return o.test(e)?e.replace(t,"&amp;").replace(n,"&lt;").replace(r,"&gt;").replace(i,"&#39;").replace(s,"&quot;"):e}e.prototype={r:function(e,t,n){return""},v:u,render:function(t,n,r){return this.r(t,n,r)},rp:function(e,t,n,r){var i=n[e];return i?i.r(t,n,r):""},rs:function(e,t,n){var r="",i=e[e.length-1];if(!a(i))return r=n(e,t);for(var s=0;s<i.length;s++){e.push(i[s]);r+=n(e,t);e.pop()}return r},s:function(e,t,n,r,i,s,o){var u;if(a(e)&&e.length===0)return!1;!r&&typeof e=="function"&&(e=this.ls(e,t,n,i,s,o));u=e===""||!!e;!r&&u&&t&&t.push(typeof e=="object"?e:t[t.length-1]);return u},d:function(e,t,n,r){var i=e.split("."),s=this.f(i[0],t,n,r),o=null;if(e==="."&&a(t[t.length-2]))return t[t.length-1];for(var u=1;u<i.length;u++)if(s&&typeof s=="object"&&i[u]in s){o=s;s=s[i[u]]}else s="";if(r&&!s)return!1;if(!r&&typeof s=="function"){t.push(o);s=this.lv(s,t,n);t.pop()}return s},f:function(e,t,n,r){var i=!1,s=null,o=!1;for(var u=t.length-1;u>=0;u--){s=t[u];if(s&&typeof s=="object"&&e in s){i=s[e];o=!0;break}}if(!o)return r?!1:"";!r&&typeof i=="function"&&(i=this.lv(i,t,n));return i},ho:function(e,t,n,r,i){var s=e.call(t,r,function(e){return Hogan.compile(e,{delimiters:i}).render(t,n)}),o=Hogan.compile(s.toString(),{delimiters:i}).render(t,n);this.b=o;return!1},b:"",ls:function(e,t,n,r,i,s){var o=t[t.length-1],u=e.call(o);return e.length>0?this.ho(e,o,n,this.text.substring(r,i),s):typeof u=="function"?this.ho(u,o,n,this.text.substring(r,i),s):u},lv:function(e,t,n){var r=t[t.length-1];return Hogan.compile(e.call(r).toString()).render(r,n)}};var t=/&/g,n=/</g,r=/>/g,i=/\'/g,s=/\"/g,o=/[&<>\"\']/,a=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};return e}(),Hogan=function(){function o(t,n){function w(){if(p.length>0){d.push(new String(p));p=""}}function E(){var t=!0;for(var n=g;n<d.length;n++){t=d[n].tag&&s[d[n].tag]<s._v||!d[n].tag&&d[n].match(e)===null;if(!t)return!1}return t}function S(e,t){w();if(e&&E()){for(var n=g,r;n<d.length;n++)if(!d[n].tag){(r=d[n+1])&&r.tag==">"&&(r.indent=d[n].toString());d.splice(n,1)}}else t||d.push({tag:"\n"});v=!1;g=d.length}function x(e,t){var n="="+b,r=e.indexOf(n,t),i=u(e.substring(e.indexOf("=",t)+1,r)).split(" ");y=i[0];b=i[1];return r+n.length-1}var r=t.length,i=0,o=1,f=2,l=i,c=null,h=null,p="",d=[],v=!1,m=0,g=0,y="{{",b="}}";if(n){n=n.split(" ");y=n[0];b=n[1]}for(m=0;m<r;m++)if(l==i)if(a(y,t,m)){--m;w();l=o}else t.charAt(m)=="\n"?S(v):p+=t.charAt(m);else if(l==o){m+=y.length-1;h=s[t.charAt(m+1)];c=h?t.charAt(m+1):"_v";if(c=="="){m=x(t,m);l=i}else{h&&m++;l=f}v=m}else if(a(b,t,m)){d.push({tag:c,n:u(p),otag:y,ctag:b,i:c=="/"?v-b.length:m+y.length});p="";m+=b.length-1;l=i;c=="{"&&m++}else p+=t.charAt(m);S(v,!0);return d}function u(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function a(e,t,n){if(t.charAt(n)!=e.charAt(0))return!1;for(var r=1,i=e.length;r<i;r++)if(t.charAt(n+r)!=e.charAt(r))return!1;return!0}function f(e,t,n,r){var i=[],s=null,o=null;while(e.length>0){o=e.shift();if(o.tag=="#"||o.tag=="^"||l(o,r)){n.push(o);o.nodes=f(e,o.tag,n,r);i.push(o)}else{if(o.tag=="/"){if(n.length===0)throw new Error("Closing tag without opener: /"+o.n);s=n.pop();if(o.n!=s.n&&!c(o.n,s.n,r))throw new Error("Nesting error: "+s.n+" vs. "+o.n);s.end=o.i;return i}i.push(o)}}if(n.length>0)throw new Error("missing closing tag: "+n.pop().n);return i}function l(e,t){for(var n=0,r=t.length;n<r;n++)if(t[n].o==e.n){e.tag="#";return!0}}function c(e,t,n){for(var r=0,i=n.length;r<i;r++)if(n[r].c==e&&n[r].o==t)return!0}function h(e,t,n){var r='i = i || "";var c = [cx];var b = i + "";var _ = this;'+v(e)+"return b;";if(n.asString)return"function(cx,p,i){"+r+";}";var i=new HoganTemplate(t);i.r=new Function("cx","p","i",r);return i}function p(e){return e.replace(i,"\\\\").replace(t,'\\"').replace(n,"\\n").replace(r,"\\r")}function d(e){return~e.indexOf(".")?"d":"f"}function v(e){var t="";for(var n=0,r=e.length;n<r;n++){var i=e[n].tag;i=="#"?t+=m(e[n].nodes,e[n].n,d(e[n].n),e[n].i,e[n].end,e[n].otag+" "+e[n].ctag):i=="^"?t+=g(e[n].nodes,e[n].n,d(e[n].n)):i=="<"||i==">"?t+=y(e[n]):i=="{"||i=="&"?t+=b(e[n].n,d(e[n].n)):i=="\n"?t+=E('"\\n"'+(e.length-1==n?"":" + i")):i=="_v"?t+=w(e[n].n,d(e[n].n)):i===undefined&&(t+=E('"'+p(e[n])+'"'))}return t}function m(e,t,n,r,i,s){return"if(_.s(_."+n+'("'+p(t)+'",c,p,1),'+"c,p,0,"+r+","+i+', "'+s+'")){'+"b += _.rs(c,p,"+'function(c,p){ var b = "";'+v(e)+"return b;});c.pop();}"+'else{b += _.b; _.b = ""};'}function g(e,t,n){return"if (!_.s(_."+n+'("'+p(t)+'",c,p,1),c,p,1,0,0,"")){'+v(e)+"};"}function y(e){return'b += _.rp("'+p(e.n)+'",c[c.length - 1],p,"'+(e.indent||"")+'");'}function b(e,t){return"b += (_."+t+'("'+p(e)+'",c,p,0));'}function w(e,t){return"b += (_.v(_."+t+'("'+p(e)+'",c,p,0)));'}function E(e){return"b += "+e+";"}var e=/\S/,t=/\"/g,n=/\n/g,r=/\r/g,i=/\\/g,s={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};return{scan:o,parse:function(e,t){t=t||{};return f(e,"",[],t.sectionTags||[])},cache:{},compile:function(e,t){t=t||{};var n=this.cache[e];if(n)return n;n=h(this.parse(o(e,t.delimiters),t),e,t);return this.cache[e]=n}}}();if(typeof module!="undefined"&&module.exports){module.exports=Hogan;module.exports.Template=HoganTemplate}else if(typeof define=="function"&&define.amd)define(function(){return Hogan});else if(typeof exports!="undefined"){exports.Hogan=Hogan;exports.HoganTemplate=HoganTemplate};