/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */var HoganTemplate=function(){function e(e){this.text=e}function u(e){var u=String(e===null?"":e);return o.test(u)?u.replace(t,"&amp;").replace(n,"&lt;").replace(r,"&gt;").replace(i,"&#39;").replace(s,"&quot;"):u}e.prototype={r:function(e,t){return""},v:u,render:function(t,n){return this.r(t,n)},rp:function(e,t,n,r){var i=n[e];return i?i.render(t,n):""},rs:function(e,t,n){var r="",i=e[e.length-1];if(!a(i)){r=n(e,t);return r}for(var s=0;s<i.length;s++){e.push(i[s]);r+=n(e,t);e.pop()}return r},s:function(e,t,n,r,i,s){if(a(e)&&e.length===0)return!1;!r&&typeof e=="function"&&(e=this.ls(e,t,n,i,s));var o=e===""||!!e;!r&&o&&t&&t.push(typeof e=="object"?e:t[t.length-1]);return o},d:function(e,t,n,r){if(e==="."&&a(t[t.length-2]))return t[t.length-1];var i=e.split("."),s=this.f(i[0],t,n,r),o=null;for(var u=1;u<i.length;u++)if(s&&typeof s=="object"&&i[u]in s){o=s;s=s[i[u]]}else s="";if(r&&!s)return!1;if(!r&&typeof s=="function"){t.push(o);s=this.lv(s,t,n);t.pop()}return s},f:function(e,t,n,r){var i=!1,s=null,o=!1;for(var u=t.length-1;u>=0;u--){s=t[u];if(s&&typeof s=="object"&&e in s){i=s[e];o=!0;break}}if(!o)return r?!1:"";!r&&typeof i=="function"&&(i=this.lv(i,t,n));return i},ho:function(e,t,n,r){var i=e.call(t,r,function(e){return Hogan.compile(e).render(t)}),s=Hogan.compile(i.toString()).render(t,n);this.b=s;return!1},b:"",ls:function(e,t,n,r,i){var s=t[t.length-1];if(e.length>0)return this.ho(e,s,n,this.text.substring(r,i));var o=e.call(s);return typeof o=="function"?this.ho(o,s,n,this.text.substring(r,i)):o},lv:function(e,t,n){var r=t[t.length-1];return Hogan.compile(e.call(r).toString()).render(r,n)}};var t=/&/g,n=/</g,r=/>/g,i=/\'/g,s=/\"/g,o=/[&<>\"\']/,a=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};return e}(),Hogan=function(){function e(e){function y(){if(c.length>0){h.push(new String(c));c=""}}function b(){var e=!0;for(var t=v;t<h.length;t++){e=h[t].tag&&r[h[t].tag]<r._v||!h[t].tag&&h[t].match(n)==null;if(!e)return!1}return e}function w(e,t){y();if(e&&b())for(var n=v;n<h.length;n++)h[n].tag||h.splice(n,1);else t||h.push({tag:"\n"});p=!1;v=h.length}function E(e,n){var r="="+g,i=e.indexOf(r,n),s=t(e.substring(e.indexOf("=",n)+1,i)).split(" ");m=s[0];g=s[1];return i+r.length-1}var s=e.length,o=0,u=1,a=2,f=o,l=null,c="",h=[],p=!1,d=0,v=0,m="{{",g="}}";for(d=0;d<s;d++)if(f==o)if(i(m,e,d)){--d;y();f=u}else e[d]=="\n"?w(p):c+=e[d];else if(f==u){d+=m.length-1;var S=r[e[d+1]];l=S?e[d+1]:"_v";p=d;if(l=="="){d=E(e,d);f=o}else{S&&d++;f=a}}else if(i(g,e,d)){d+=g.length-1;h.push({tag:l,n:t(c),i:l=="/"?p-1:d+1});c="";f=o;l=="{"&&d++}else c+=e[d];w(p,!0);return h}function t(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function i(e,t,n){if(t[n]!=e[0])return!1;for(var r=1,i=e.length;r<i;r++)if(t[n+r]!=e[r])return!1;return!0}function s(e,t,n,r){var i=[],a=null,f=null;while(e.length>0){f=e.shift();if(f.tag=="#"||f.tag=="^"||o(f,r)){n.push(f);f.nodes=s(e,f.tag,n,r);i.push(f)}else{if(f.tag=="/"){if(n.length==0)throw new Error("Closing tag without opener: /"+f.n);a=n.pop();if(f.n!=a.n&&!u(f.n,a.n,r))throw new Error("Nesting error: "+a.n+" vs. "+f.n);a.end=f.i;return i}i.push(f)}}if(n.length>0)throw new Error("missing closing tag: "+n.pop().n);return i}function o(e,t){for(var n=0,r=t.length;n<r;n++)if(t[n].o==e.n){e.tag="#";return!0}}function u(e,t,n){for(var r=0,i=n.length;r<i;r++)if(n[r].c==e&&n[r].o==t)return!0}function a(e,t,n){var r='var c = [cx];var b = "";var _ = this;'+v(e)+"return b;";if(n.asString)return"function(cx,p){"+r+";};";var i=new HoganTemplate(t);i.r=new Function("cx","p",r);return i}function p(e){return e.replace(h,"\\\\").replace(f,'\\"').replace(l,"\\n").replace(c,"\\r")}function d(e){return~e.indexOf(".")?"d":"f"}function v(e){var t="";for(var n=0,r=e.length;n<r;n++){var i=e[n].tag;i=="#"?t+=m(e[n].nodes,e[n].n,d(e[n].n),e[n].i,e[n].end):i=="^"?t+=g(e[n].nodes,e[n].n,d(e[n].n)):i=="<"||i==">"?t+=y(e[n].n):i=="{"||i=="&"?t+=b(e[n].n,d(e[n].n)):i=="\n"?t+=E("\n"):i=="_v"?t+=w(e[n].n,d(e[n].n)):i===undefined&&(t+=E(e[n]))}return t}function m(e,t,n,r,i){var s="if(_.s(_."+n+'("'+p(t)+'",c,p,1),';s+="c,p,0,"+r+","+i+")){";s+="b += _.rs(c,p,";s+='function(c,p){ var b = "";';s+=v(e);s+="return b;});c.pop();}";s+='else{b += _.b; _.b = ""};';return s}function g(e,t,n){var r="if (!_.s(_."+n+'("'+p(t)+'",c,p,1),c,p,1,0,0)){';r+=v(e);r+="};";return r}function y(e){return'b += _.rp("'+p(e)+'",c[c.length - 1],p);'}function b(e,t){return"b += (_."+t+'("'+p(e)+'",c,p,0));'}function w(e,t){return"b += (_.v(_."+t+'("'+p(e)+'",c,p,0)));'}function E(e){return'b += "'+p(e)+'";'}var n=/\S/,r={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10},f=/\"/g,l=/\n/g,c=/\r/g,h=/\\/g;return{scan:e,parse:function(e,t){t=t||{};return s(e,"",[],t.sectionTags||[])},cache:{},compile:function(t,n){n=n||{};var r=this.cache[t];if(r)return r;r=a(this.parse(e(t),n),t,n);return this.cache[t]=r}}}();if(typeof module!="undefined"&&module.exports){module.exports=Hogan;module.exports.Template=HoganTemplate}else if(typeof exports!="undefined"){exports.Hogan=Hogan;exports.HoganTemplate=HoganTemplate};