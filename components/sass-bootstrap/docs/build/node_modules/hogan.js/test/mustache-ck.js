/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */function send(e){buf+="-FOO "+e+" FOO-"}function is(e,t,n){if(e===t){output("OK:   "+n);++passed}else{output("FAIL: "+n);output("Expected |"+t+"|");output("     Got |"+e+"|");++failed}}function complete(){output("\nTests Complete");output("--------------");output("Passed: "+passed);output("Failed: "+failed);output("\n")}var doc=this.document,fs=require("fs"),passed=0,failed=0;if(!this.output)var output=function(e){return doc?doc.write(e+"<br/>"):console.log(e)};var Hogan=require(__dirname+"/../lib/hogan"),template=fs.readFileSync(__dirname+"/../lib/template.js").toString(),compiler=fs.readFileSync(__dirname+"/../lib/compiler.js").toString(),mustache_wrapper=fs.readFileSync(__dirname+"/../wrappers/mustache.js.mustache").toString(),engines=(new Function(Hogan.compile(mustache_wrapper).render({template:template,compiler:compiler})+"; return {Hogan: Hogan, Mustache: Mustache};"))(),Mustache=engines.Mustache,Hogan2=engines.Hogan;is(Mustache.hasOwnProperty("to_html"),!0,"Mustache has to_html method.");var context={foo:"bar",mypartial:{baz:"qux"}},text="abc {{foo}} def {{>mypartial}} ghi",partialText="{{baz}}",s=Mustache.to_html(text,context,{mypartial:partialText});is(s,"abc bar def qux ghi","Correct emulation of Mustache.js partial-name-in-context resolution.");var t=Hogan2.compile(text);s=t.render(context,{mypartial:partialText});is(s,"abc bar def  ghi","Hogan behavior not changed by Mustache.js emulation.");var buf="",s=Mustache.to_html(text,context,{mypartial:partialText},send);is(buf,"-FOO abc bar def qux ghi FOO-","Correct emulation of Mustache.js sendFun.");complete();